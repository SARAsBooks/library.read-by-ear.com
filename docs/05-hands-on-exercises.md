# Hands-on Exercises

> **⚠️ LLM-Generated Documentation Disclaimer**: This documentation was generated by an AI language model and has not yet been edited or verified by the Sara's Books team. While efforts have been made to ensure accuracy, please verify code examples and file paths before use. Report any issues or inaccuracies to the development team.

These short labs help you build intuition about data flow and Convex integration.

## A. Create a new student and inspect session

1. Start the app and open it in a browser.
2. Trigger the [`GET /api/student/new`](../src/app/api/student/new/route.ts) (via UI if present or direct request) to get a new session with `studentId`.
3. Inspect localStorage key `session` and observe fields like `sessionId`, `studentId`, `lastActive`, `saveProgress`.

**Real code example**:

```typescript
// From src/app/api/student/new/route.ts
export async function GET(request: NextRequest) {
  const session = await getSession();
  session.studentId = uuid(); // New UUID generated here
  await updateSession(session);
  return NextResponse.json(session);
}
```

Checkpoint:

- You can locate `session$` in [`src/frontend/observable/sessions.ts`](../src/frontend/observable/sessions.ts) and follow how it persists/merges.

## B. Toggle local vs sync

1. In code or UI, set `session$.saveProgress` to `"local"` and then to `"sync"`.
2. Optionally set `session.useConvex = true`.
3. Observe `library$` behavior in [`src/frontend/observable/librarys.ts`](../src/frontend/observable/librarys.ts).

Checkpoint:

- With Convex URL set and `useConvex` true, reads/writes go through Convex helpers and hooks.

## C. Add a bookmark

1. In a component, import and call `const addBookmark = useAddBookmark()` from [`src/lib/convex/hooks.ts`](../src/lib/convex/hooks.ts) and invoke it with `{ studentId, readingId, currentPage }`.
2. Alternatively, call `convexLibrarySync.addBookmark` from [`src/lib/convex/sync.ts`](../src/lib/convex/sync.ts).
3. Fetch library via `useLibrary(studentId)` and confirm bookmark.

Checkpoint:

- In hooks, timestamps are converted to `Date` for UI convenience.

## D. Record learning responses

1. Use `const addResponse = useAddResponse()` to add responses for a given word.
2. Confirm `useLearningRecords(studentId)` shows updated data.
3. Observe background audit POST to [`/api/learning-audit`](../src/app/api/learning-audit/route.ts) in dev tools.

Checkpoint:

- See [`convex/learning.ts`](../convex/learning.ts) for the mutation + audit logic.

## E. Fluency levels

1. Call `useFluencyLevels(studentId)` or `useWordFluencyLevel(studentId, word)`.
2. Confirm expected transitions after multiple Recognition responses.

## F. Preferences

1. Use `usePreferences(studentId)` and `useSetPreferences()` to toggle `saveProgress` and `useConvex`.
2. Observe how this affects sync choices.

---

If Convex isn't available (URL not set), expect local behavior or legacy server action paths.

---

**Previous**: [API Tutorial](./04-api-tutorial.md) | **Next**: [Troubleshooting](./06-troubleshooting.md)
